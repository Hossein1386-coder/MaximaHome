<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffbd39">
    <title>MaximaHome • PWA</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/web-app-manifest-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/css/pwa.css">
</head>
<body>
    <script>
        (function() {
            // اگر به اشتباه از روت دامنه یا بدون scope فراخوانی شد، به /pwa/ ریدایرکت کن
            try {
                var path = location.pathname;
                if (!path.startsWith('/pwa/')) {
                    var url = new URL(location.href);
                    url.pathname = '/pwa/';
                    url.searchParams.set('app', '1');
                    location.replace(url.toString());
                }
            } catch (e) {}
        })();
    </script>
    <header class="container pwa-header">
        <div class="brand">
            <span class="dot"></span>
            <h5>maximahome.ir</h5>
        </div>
        <button id="installBtn" class="pwa-cta">نصب</button>
    </header>

    <main class="container pb-5 mb-5">
        <!-- Home -->
        <section id="view-home" class="view active">
            <div class="pwa-card mb-3 text-center">
                <h5 class="mb-2">مجموعه ماکسیما هوم</h5>
                <p class="mb-3 text-muted">در مجموعه ما انواع تعمیرات انجام میشه</p>
                <div class="grid-2 mb-3">
                    <a class="btn-pill" href="/blog.html">اخبار</a>
                    <a class="btn-pill" href="/index.html#about-section">درباره ما</a>
                    <a class="btn-pill" href="/index.html#services-section">خدمات ما</a>
                    <a class="btn-pill" href="/index.html#contact-section">تماس با ما</a>
                </div>
                <img src="/images/88.png" alt="car" class="hero-img">
            </div>
        </section>

        <!-- Booking -->
        <section id="view-book" class="view">
            <form id="pwa-booking-form" class="mb-3">
                <div class="pwa-card mb-3">
                    <h6 class="mb-3">انتخاب خدمات</h6>
                    <div class="chips">
                        <label class="chip"><input type="radio" name="serviceType" value="engine" required><span>موتور</span></label>
                        <label class="chip"><input type="radio" name="serviceType" value="inspection"><span>بازدید دوره‌ای</span></label>
                        <label class="chip"><input type="radio" name="serviceType" value="transmission"><span>گیربکس</span></label>
                        <label class="chip"><input type="radio" name="serviceType" value="timing"><span>تسمه تایم</span></label>
                    </div>
                </div>
                <div class="pwa-card mb-3">
                    <h6 class="mb-3">انتخاب تاریخ و زمان</h6>
                    <input class="input" name="date" type="date" placeholder="YYYY-MM-DD" required>
                    <input class="input" name="time" type="time" value="10:00" required>
                </div>
                <div class="pwa-card mb-3">
                    <h6 class="mb-3">اطلاعات تماس و خودرو</h6>
                    <input class="input" name="name" type="text" placeholder="نام و نام خانوادگی" required>
                    <input class="input" name="phone" type="tel" placeholder="شماره تماس" required>
                    <input class="input" name="carBrand" type="text" placeholder="برند خودرویی" required>
                    <input class="input" name="carModel" type="text" placeholder="مدل خودرویی" required>
                    <textarea class="input" name="description" placeholder="توضیحات" rows="3" style="height:auto"></textarea>
                    <input type="hidden" name="source" value="pwa">
                    <button type="submit" class="btn-primary w-100">تکمیل</button>
                    <div id="pwa-booking-msg" style="margin-top:10px;font-size:12px;color:#16a34a;display:none">درخواست شما ثبت شد.</div>
                </div>
            </form>
        </section>

        <!-- Services -->
        <section id="view-services" class="view">
            <h6 class="mb-2 px-2">خدمات ماکسیما هوم</h6>
            <a class="pwa-card mb-3 text-center" href="/index.html#services-section" style="display:block;text-decoration:none;color:inherit">
                <img src="/images/new6.png" class="svc-img" alt>
                <h6 class="mt-2">تعمیر ماکسیما</h6>
                <small class="text-muted">تعمیر بلبرینگ، چرخ، گیربکس ماکسیما</small>
            </a>
            <a class="pwa-card mb-3 text-center" href="/index.html#services-section" style="display:block;text-decoration:none;color:inherit">
                <img src="/images/33.png" class="svc-img" alt>
                <h6 class="mt-2">تعمیر خودرو چینی</h6>
                <small class="text-muted">انواع خودروهای چینی</small>
            </a>
        </section>

        <!-- Support / Contact -->
        <section id="view-support" class="view">
            <div class="pwa-card mb-3 text-center">
                <h6 class="mb-3">اطلاعات تماس</h6>
                <p class="mb-2"><a href="tel:09902524062">09902524062</a></p>
                <p class="mb-3"><a href="tel:09140748037">09140748037</a></p>
                <div class="grid-2">
                    <a class="btn-primary" href="tel:09140748037" style="text-align:center">تماس</a>
                    <a class="btn-primary" href="https://wa.me/989140748037" target="_blank" style="text-align:center">واتساپ</a>
                </div>
            </div>
            <div class="pwa-card mb-3 text-center">
                <h6 class="mb-3">لوکیشن</h6>
                <img src="/images/22.png" class="hero-img" alt>
                <a class="btn-primary w-100 mt-3" href="https://www.google.com/maps/search/?api=1&query=%DB%8C%D8%B2%D8%AF+%D8%A8%D9%84%D9%88%D8%A7%D8%B1+%D8%AE%D8%A7%D9%85%D9%86%D9%87+%D8%A7%DB%8C+%D8%AE%DB%8C%D8%A7%D8%A8%D8%A7%D9%86+%D8%A7%D9%86%D8%AF%DB%8C%D8%B4%D9%87+-+%D8%A7%D9%86%D8%AF%DB%8C%D8%B4%D9%87+6" target="_blank">یافتن</a>
            </div>
        </section>
    </main>

    <nav class="app-menu">
        <div class="container d-flex justify-content-between">
            <a class="app-menu-item active" data-tab="home">خانه</a>
            <a class="app-menu-item" data-tab="book">رزرو</a>
            <a class="app-menu-item" data-tab="services">سرویس‌ها</a>
            <a class="app-menu-item" data-tab="support">پشتیبانی</a>
        </div>
    </nav>

    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'inline-block';
        });
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            await deferredPrompt.userChoice;
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() { navigator.serviceWorker.register('/pwa/sw.js'); });
        }

        // تب‌ها
        (function(){
            var tabs = document.querySelectorAll('.app-menu-item');
            var views = {
                home: document.getElementById('view-home'),
                book: document.getElementById('view-book'),
                services: document.getElementById('view-services'),
                support: document.getElementById('view-support')
            };
            function activate(name){
                document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
                Object.keys(views).forEach(k=>views[k].style.display='none');
                views[name].style.display='block';
                views[name].classList.add('active');
                tabs.forEach(t=>t.classList.remove('active'));
                document.querySelector('.app-menu-item[data-tab='+name+']').classList.add('active');
            }
            tabs.forEach(t=>t.addEventListener('click',()=>activate(t.getAttribute('data-tab'))));
            // init
            Object.keys(views).forEach(k=>views[k].style.display='none');
            views.home.style.display='block';
        })();

        // ارسال فرم به Formspree
        (function(){
            var form = document.getElementById('pwa-booking-form');
            if (!form) return;
            var msg = document.getElementById('pwa-booking-msg');
            form.addEventListener('submit', function(e){
                e.preventDefault();
                var data = new FormData(form);
                fetch('https://formspree.io/f/your-form-id', {
                    method: 'POST',
                    headers: { 'Accept': 'application/json' },
                    body: data
                }).then(function(res){
                    if (res.ok) {
                        msg.style.display = 'block';
                        form.reset();
                    } else { alert('خطا در ثبت.'); }
                }).catch(function(){ alert('عدم دسترسی به سرور.'); });
            });
        })();
    </script>
</body>
</html>

